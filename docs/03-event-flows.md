# Event Flows

This document describes the end-to-end data flows through the platform, from vehicle telemetry ingestion to user-facing dashboards.

---

## Flow 1: Telemetry Ingestion

The telemetry data path from vehicle to storage.

<p align="center">
  <img src="/diagrams/Telemetry_Ingestion_Flow.png" alt="Telemetry Ingestion Flow" width="100%"/>
</p>

### Message Types Processed

| Type | Proto | Frequency | Storage | Description |
|------|-------|-----------|---------|-------------|
| Vehicle Data | `protos.Payload` | Every few seconds | Redis, DynamoDB | Data event generated by vehicle |
| Alerts | `protos.VehicleAlerts` | On event | DynamoDB | Alert event generated by vehicle |
| Errors | `protos.VehicleErrors` | On event | DynamoDB | Error event used for internal debugging |
| Connectivity | `protos.VehicleConnectivity` | On change | DynamoDB | Connection event used for internal debugging |

---

## Flow 2: Real-Time Dashboard Updates

How live data is pushed and updates the customer's web app dashboard.

<p align="center">
  <img src="/diagrams/Realtime_Dashboard_Updates.png" alt="Real-time Dashboard Flow" width="100%"/>
</p>

### Latency Budget

| Stage | Target | Actual |
|-------|--------|--------|
| Vehicle → Kinesis | < 100ms | ~50ms |
| Kinesis → Consumer | < 200ms | ~100ms |
| Consumer → Redis | < 10ms | ~5ms |
| Redis → SSE Server | < 10ms | ~2ms |
| SSE → Browser | < 100ms | ~50ms |
| **Total** | **< 500ms** | **~200ms** |

---

## Flow 3: Trip Lifecycle

How trips are recorded and processed.
<p align="center">
  <img src="/diagrams/Trip_Lifecycle_Flow.png" alt="Trip Recording and Lifecycle Flow" width="100%"/>
</p>

---

## Flow 4: Vehicle Command

How commands are securely processed from customer's dashboard to the vehicle command endpoint.

<p align="center">
  <img src="/diagrams/Vehicle_Command_Flow.png" alt="Vehicle Command Flow" width="100%"/>
</p>


---

## Flow 5: Emergency Alert & Dashcam Archive

Triggered when the Telemetry Consumer detects a collision or critical safety event.

<p align="center">
  <img src="/diagrams/Alert_and_Dashcam_Archive_Flow.png" alt="Alert & Dashcam Archive Flow" width="100%"/>
</p>


### Examples of Alert Types 

| Alert Type | Severity | Dashcam-Archive | Retention |
|------------|----------|-----------------|-----------|
| Collision Detected | Critical | ✓ | 1 year |
| Airbag Deployment (Pyrotechnical Devices Deployed) | Critical | ✓ | 1 year |
| Pedestrian Involved Collision | Critical | ✓ | 1 year |
| Sentry Mode Alert (Panicked State) | Critical | ✓ | 1 year |
| Forward or Side Collision Warning System Intervention | Critical | ✓ | 1 year |
| Aggressive Turning (Left/Right Acceleration >0.4g) | High | Optional | 30 days |
| Hard Braking (Backward Acceleration >0.3g) | High | Optional | 30 days |
| Excessive Speeding (VehicleSpeed > 85mph) | High | Optional | 30 days |
| Unauthorized Movement (Driving Time / Geofence) | High | Optional | 30 days |
| Service Alerts | Medium | Optional | 30 days |


---

## Related Documents

- [Architecture Overview](01-architecture-overview.md)
- [Data Model](03-data-model.md)
- [ADR: Kinesis over SQS](../adrs/001-kinesis-over-sqs.md)
- [ADR: Redis for Real-time](../adrs/007-redis-for-realtime.md)
